---
description: Quick reference for do's and don'ts
globs:
  - "backend/**/*"
  - "frontend/**/*"
alwaysApply: true
---

# Quick Reference

## ✅ DO

### API
- ✅ Use GraphQL for all API endpoints
- ✅ Use subscriptions for real-time data
- ✅ Authenticate all operations (except health checks)
- ✅ Return `{ success, error }` from mutations

### Frontend
- ✅ Use HeroUI components (Button, Card, Input, Modal, etc.)
- ✅ Use `@tabler/icons-react` for all icons (not emojis or custom SVGs)
- ✅ Use TanStack Router for routing
- ✅ Use urql + graphql-ws for GraphQL
- ✅ Define GraphQL operations in `lib/graphql.ts`
- ✅ Use Tailwind CSS for custom styling

### Backend
- ✅ Use async-graphql for the API
- ✅ Use sqlx with compile-time query checking
- ✅ Use anyhow for error handling
- ✅ Use tracing for logging
- ✅ Put business logic in services
- ✅ Put database queries in repositories

### Database
- ✅ Create numbered migrations (001_, 002_, etc.)
- ✅ Use UUIDs for primary keys
- ✅ Use TIMESTAMPTZ for timestamps
- ✅ Enable RLS for user-scoped tables
- ✅ Store settings in app_settings table

### Torrents
- ✅ Use librqbit (native Rust client)
- ✅ Persist torrent state to database
- ✅ Broadcast events via channels
- ✅ Load settings from database

## ❌ DON'T

### API
- ❌ Create REST endpoints (except file uploads, health, torznab, media streaming)
- ❌ Use WebSockets directly (use GraphQL subscriptions)
- ❌ Expose internal errors to users
- ❌ Skip authentication checks

### Frontend
- ❌ Use raw HTML elements when HeroUI has a component
- ❌ Use emojis for icons (use `@tabler/icons-react` instead)
- ❌ Create custom SVG icon components
- ❌ Use Redux or other state managers (use React hooks + urql cache)
- ❌ Create custom form components (use HeroUI Input, Select, etc.)
- ❌ Hard-code API URLs (use VITE_API_URL env var)

### Backend
- ❌ Use println! for logging (use tracing)
- ❌ Panic on recoverable errors (return Result)
- ❌ Put business logic in route handlers
- ❌ Use external torrent clients (qBittorrent, etc.)

### Database
- ❌ Use raw SQL in GraphQL resolvers (use repositories)
- ❌ Store user-specific data without RLS
- ❌ Use TIMESTAMP without timezone
- ❌ Create tables without updated_at triggers

## Key Files

| Purpose | Location |
|---------|----------|
| GraphQL Schema | `backend/src/graphql/schema.rs` |
| GraphQL Types | `backend/src/graphql/types.rs` |
| GraphQL Subscriptions | `backend/src/graphql/subscriptions.rs` |
| Torrent Service | `backend/src/services/torrent.rs` |
| Organizer Service | `backend/src/services/organizer.rs` |
| Download Monitor Job | `backend/src/jobs/download_monitor.rs` |
| Filename Parser | `backend/src/services/filename_parser.rs` |
| Database Connection | `backend/src/db/mod.rs` |
| Settings Repository | `backend/src/db/settings.rs` |
| Indexer Trait | `backend/src/indexer/mod.rs` |
| Indexer Manager | `backend/src/indexer/manager.rs` |
| IPTorrents Indexer | `backend/src/indexer/definitions/iptorrents.rs` |
| Indexer DB Repository | `backend/src/db/indexers.rs` |
| Frontend GraphQL | `frontend/src/lib/graphql/` |
| Frontend Routes | `frontend/src/routes/` |
| Hunt Page | `frontend/src/routes/hunt.tsx` |
| Search Modal | `frontend/src/components/SearchModal.tsx` |
| Add to Library Modal | `frontend/src/components/search/AddToLibraryModal.tsx` |
| Library Detail Page | `frontend/src/routes/libraries/$libraryId.tsx` |
| Indexers Settings Page | `frontend/src/routes/settings/indexers.tsx` |

## Naming Conventions

### Rust
- `snake_case` for functions, variables, modules
- `PascalCase` for types, traits, enums
- `SCREAMING_SNAKE_CASE` for constants

### TypeScript
- `camelCase` for functions, variables
- `PascalCase` for components, types, interfaces
- `SCREAMING_SNAKE_CASE` for constants

### Database
- `snake_case` for tables, columns
- Plural table names (`torrents`, `libraries`)
- Foreign keys: `{table}_id` (e.g., `user_id`)

### GraphQL
- `camelCase` for fields (auto-converted from Rust snake_case)
- `PascalCase` for types
- `SCREAMING_SNAKE_CASE` for enum values
